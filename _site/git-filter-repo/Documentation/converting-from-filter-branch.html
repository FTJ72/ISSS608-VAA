<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ISSS608-VAA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ISSS608-VAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex01/In-class_Ex01.html">
 <span class="dropdown-text">In-Class Exercise 1</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-Home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01.html">
 <span class="dropdown-text">Take-Home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex02/Take-home_Ex02.html">
 <span class="dropdown-text">Take-Home Exercise 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#cheat-sheet-converting-from-filter-branch" id="toc-cheat-sheet-converting-from-filter-branch" class="nav-link active" data-scroll-target="#cheat-sheet-converting-from-filter-branch">Cheat Sheet: Converting from filter-branch</a>
  <ul class="collapse">
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link" data-scroll-target="#table-of-contents">Table of Contents</a></li>
  <li><a href="#half-hearted-conversions" id="toc-half-hearted-conversions" class="nav-link" data-scroll-target="#half-hearted-conversions">Half-hearted conversions</a></li>
  <li><a href="#intention-of-equivalent-commands" id="toc-intention-of-equivalent-commands" class="nav-link" data-scroll-target="#intention-of-equivalent-commands">Intention of “equivalent” commands</a></li>
  <li><a href="#basic-differences" id="toc-basic-differences" class="nav-link" data-scroll-target="#basic-differences">Basic Differences</a></li>
  <li><a href="#cheat-sheet-conversion-of-examples-from-the-filter-branch-manpage" id="toc-cheat-sheet-conversion-of-examples-from-the-filter-branch-manpage" class="nav-link" data-scroll-target="#cheat-sheet-conversion-of-examples-from-the-filter-branch-manpage">Cheat Sheet: Conversion of Examples from the filter-branch manpage</a>
  <ul class="collapse">
  <li><a href="#removing-a-file" id="toc-removing-a-file" class="nav-link" data-scroll-target="#removing-a-file">Removing a file</a></li>
  <li><a href="#extracting-a-subdirectory" id="toc-extracting-a-subdirectory" class="nav-link" data-scroll-target="#extracting-a-subdirectory">Extracting a subdirectory</a></li>
  <li><a href="#moving-the-whole-tree-into-a-subdirectory" id="toc-moving-the-whole-tree-into-a-subdirectory" class="nav-link" data-scroll-target="#moving-the-whole-tree-into-a-subdirectory">Moving the whole tree into a subdirectory</a></li>
  <li><a href="#re-grafting-history" id="toc-re-grafting-history" class="nav-link" data-scroll-target="#re-grafting-history">Re-grafting history</a></li>
  <li><a href="#removing-commits-by-a-certain-author" id="toc-removing-commits-by-a-certain-author" class="nav-link" data-scroll-target="#removing-commits-by-a-certain-author">Removing commits by a certain author</a></li>
  <li><a href="#rewriting-commit-messages-removing-text" id="toc-rewriting-commit-messages-removing-text" class="nav-link" data-scroll-target="#rewriting-commit-messages-removing-text">Rewriting commit messages – removing text</a></li>
  <li><a href="#rewriting-commit-messages-adding-text" id="toc-rewriting-commit-messages-adding-text" class="nav-link" data-scroll-target="#rewriting-commit-messages-adding-text">Rewriting commit messages – adding text</a></li>
  <li><a href="#changing-authorcommittertagger-information" id="toc-changing-authorcommittertagger-information" class="nav-link" data-scroll-target="#changing-authorcommittertagger-information">Changing author/committer(/tagger?) information</a></li>
  <li><a href="#restricting-to-a-range" id="toc-restricting-to-a-range" class="nav-link" data-scroll-target="#restricting-to-a-range">Restricting to a range</a></li>
  </ul></li>
  <li><a href="#cheat-sheet-additional-conversion-examples" id="toc-cheat-sheet-additional-conversion-examples" class="nav-link" data-scroll-target="#cheat-sheet-additional-conversion-examples">Cheat Sheet: Additional conversion examples</a>
  <ul class="collapse">
  <li><a href="#running-a-code-formatter-or-linter-on-each-file-with-some-extension" id="toc-running-a-code-formatter-or-linter-on-each-file-with-some-extension" class="nav-link" data-scroll-target="#running-a-code-formatter-or-linter-on-each-file-with-some-extension">Running a code formatter or linter on each file with some extension</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="cheat-sheet-converting-from-filter-branch" class="level1">
<h1>Cheat Sheet: Converting from filter-branch</h1>
<p>This document is aimed at folks who are familiar with filter-branch and want to learn how to convert over to using filter-repo.</p>
<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#half-hearted-conversions">Half-hearted conversions</a></li>
<li><a href="#intention-of-equivalent-commands">Intention of “equivalent” commands</a></li>
<li><a href="#basic-differences">Basic Differences</a></li>
<li><a href="#cheat-sheet-conversion-of-examples-from-the-filter-branch-manpage">Cheat Sheet: Conversion of Examples from the filter-branch manpage</a></li>
<li><a href="#cheat-sheet-additional-conversion-examples">Cheat Sheet: Additional conversion examples</a></li>
</ul>
</section>
<section id="half-hearted-conversions" class="level2">
<h2 class="anchored" data-anchor-id="half-hearted-conversions">Half-hearted conversions</h2>
<p>You can switch nearly any <code>git filter-branch</code> command to use filter-repo under the covers by just replacing the <code>git filter-branch</code> part of the command with <a href="../contrib/filter-repo-demos/filter-lamely"><code>filter-lamely</code></a>. The git.git regression testsuite passes when I swap out the filter-branch script with filter-lamely, for example. (However, the filter-branch tests are not very comprehensive, so don’t rely on that too much.)</p>
<p>Doing a half-hearted conversion has nearly all of the drawbacks of filter-branch and nearly none of the benefits of filter-repo, but it will make your command run a few times faster and makes for a very simple conversion.</p>
<p>You’ll get a lot more performance, safety, and features by just switching to direct filter-repo commands.</p>
</section>
<section id="intention-of-equivalent-commands" class="level2">
<h2 class="anchored" data-anchor-id="intention-of-equivalent-commands">Intention of “equivalent” commands</h2>
<p>filter-branch and filter-repo have different defaults, as highlighted in the Basic Differences section below. As such, getting a command which behaves identically is not possible. Also, sometimes the filter-branch manpage lies, e.g.&nbsp;it says “suppose you want to…from all commits” and then uses a command line like “git filter-branch … HEAD”, which only operates on commits in the current branch rather than on all commits.</p>
<p>Rather than focusing on matching filter-branch output as exactly as possible, I treat the filter-branch examples as idiomatic ways to solve a certain type of problem with filter-branch, and express how one would idiomatically solve the same problem in filter-repo. Sometimes that means the results are not identical, but they are largely the same in each case.</p>
</section>
<section id="basic-differences" class="level2">
<h2 class="anchored" data-anchor-id="basic-differences">Basic Differences</h2>
<p>With <code>git filter-branch</code>, you have a git repository where every single commit (within the branches or revisions you specify) is checked out and then you run one or more shell commands to transform the working copy into your desired end state.</p>
<p>With <code>git filter-repo</code>, you are essentially given an editing tool to operate on the <a href="https://git-scm.com/docs/git-fast-export">fast-export</a> serialization of a repo. That means there is an input stream of all the contents of the repository, and rather than specifying filters in the form of commands to run, you usually employ a number of common pre-defined filters that provide various ways to slice, dice, or modify the repo based on its components (such as pathnames, file content, user names or emails, etc.) That makes common operations easier, even if it’s not as versatile as shell callbacks. For cases where more complexity or special casing is needed, filter-repo provides python callbacks that can operate on the data structures populated from the fast-export stream to do just about anything you want.</p>
<p>filter-branch defaults to working on a subset of the repository, and requires you to specify a branch or branches, meaning you need to specify <code>-- --all</code> to modify all commits. filter-repo by contrast defaults to rewriting everything, and you need to specify <code>--refs &lt;rev-list-args&gt;</code> if you want to limit to just a certain set of branches or range of commits. (Though any <code>&lt;rev-list-args&gt;</code> that begin with a hyphen are not accepted by filter-repo as they look like the start of different options.)</p>
<p>filter-repo also takes care of additional concerns automatically, like rewriting commit messages that reference old commit IDs to instead reference the rewritten commit IDs, pruning commits which do not start empty but become empty due to the specified filters, and automatically shrinking and gc’ing the repo at the end of the filtering operation.</p>
</section>
<section id="cheat-sheet-conversion-of-examples-from-the-filter-branch-manpage" class="level2">
<h2 class="anchored" data-anchor-id="cheat-sheet-conversion-of-examples-from-the-filter-branch-manpage">Cheat Sheet: Conversion of Examples from the filter-branch manpage</h2>
<section id="removing-a-file" class="level3">
<h3 class="anchored" data-anchor-id="removing-a-file">Removing a file</h3>
<p>The filter-branch manual provided three different examples of removing a single file, based on different levels of ease vs.&nbsp;carefulness and performance:</p>
<pre class="shell"><code>  git filter-branch --tree-filter 'rm filename' HEAD</code></pre>
<pre class="shell"><code>  git filter-branch --tree-filter 'rm -f filename' HEAD</code></pre>
<pre class="shell"><code>  git filter-branch --index-filter 'git rm --cached --ignore-unmatch filename' HEAD</code></pre>
<p>All of these just become</p>
<pre class="shell"><code>  git filter-repo --invert-paths --path filename</code></pre>
</section>
<section id="extracting-a-subdirectory" class="level3">
<h3 class="anchored" data-anchor-id="extracting-a-subdirectory">Extracting a subdirectory</h3>
<p>Extracting a subdirectory via</p>
<pre class="shell"><code>  git filter-branch --subdirectory-filter foodir -- --all</code></pre>
<p>is one of the easiest commands to convert; it just becomes</p>
<pre class="shell"><code>  git filter-repo --subdirectory-filter foodir</code></pre>
</section>
<section id="moving-the-whole-tree-into-a-subdirectory" class="level3">
<h3 class="anchored" data-anchor-id="moving-the-whole-tree-into-a-subdirectory">Moving the whole tree into a subdirectory</h3>
<p>Keeping all files but placing them in a new subdirectory via</p>
<pre class="shell"><code>  git filter-branch --index-filter \
      'git ls-files -s | sed "s-\t\"*-&amp;newsubdir/-" |
              GIT_INDEX_FILE=$GIT_INDEX_FILE.new \
                      git update-index --index-info &amp;&amp;
       mv "$GIT_INDEX_FILE.new" "$GIT_INDEX_FILE"' HEAD</code></pre>
<p>(which happens to be GNU-specific and will fail with BSD userland in very subtle ways) becomes</p>
<pre class="shell"><code>  git filter-repo --to-subdirectory-filter newsubdir</code></pre>
<p>(which works fine regardless of GNU vs BSD userland differences.)</p>
</section>
<section id="re-grafting-history" class="level3">
<h3 class="anchored" data-anchor-id="re-grafting-history">Re-grafting history</h3>
<p>The filter-branch manual provided one example with three different commands that could be used to achieve it, though the first of them had limited applicability (only when the repo had a single initial commit). These three examples were:</p>
<pre class="shell"><code>  git filter-branch --parent-filter 'sed "s/^\$/-p &lt;graft-id&gt;/"' HEAD</code></pre>
<pre class="shell"><code>  git filter-branch --parent-filter \
      'test $GIT_COMMIT = &lt;commit-id&gt; &amp;&amp; echo "-p &lt;graft-id&gt;" || cat' HEAD</code></pre>
<pre class="shell"><code>  git replace --graft $commit-id $graft-id
  git filter-branch $graft-id..HEAD</code></pre>
<p>git-replace did not exist when the original two examples were written, but it is clear that the last example is far easier to understand. As such, filter-repo just uses the same mechanism:</p>
<pre class="shell"><code>  git replace --graft $commit-id $graft-id
  git filter-repo --force</code></pre>
<p>NOTE: –force should usually be avoided unless you have taken care to make sure you have a backup (or are running on a fresh clone of) your repo. It is needed in this case because filter-repo errors out when no arguments are specified, and because it usually first checks whether you are in a fresh clone before irrecoverably rewriting your repository (git-replace created a new graft and thus added something to your previously fresh clone).</p>
</section>
<section id="removing-commits-by-a-certain-author" class="level3">
<h3 class="anchored" data-anchor-id="removing-commits-by-a-certain-author">Removing commits by a certain author</h3>
<p>WARNING: This is a BAD example for BOTH filter-branch and filter-repo. It does not remove the changes the user made from the repo, it just removes the commit in question while smashing the changes from it into any subsequent commits as though the subsequent authors had been responsible for those changes as well. <code>git rebase</code> is likely to be a better fit for what you really want if you are looking at this example. (See also <a href="https://github.com/newren/git-filter-repo/issues/62#issuecomment-597725502">this explanation of the differences between rebase and filter-repo</a>)</p>
<p>This filter-branch example</p>
<pre class="shell"><code>  git filter-branch --commit-filter '
      if [ "$GIT_AUTHOR_NAME" = "Darl McBribe" ];
      then
          skip_commit "$@";
      else
          git commit-tree "$@";
      fi' HEAD</code></pre>
<p>becomes</p>
<pre class="shell"><code>  git filter-repo --commit-callback '
      if commit.author_name == b"Darl McBribe":
          commit.skip()
      '</code></pre>
</section>
<section id="rewriting-commit-messages-removing-text" class="level3">
<h3 class="anchored" data-anchor-id="rewriting-commit-messages-removing-text">Rewriting commit messages – removing text</h3>
<p>Removing git-svn-id: lines from commit messages via</p>
<pre class="shell"><code>  git filter-branch --msg-filter '
      sed -e "/^git-svn-id:/d"
      '</code></pre>
<p>becomes</p>
<pre class="shell"><code>  git filter-repo --message-callback '
      return re.sub(b"^git-svn-id:.*\n", b"", message, flags=re.MULTILINE)
      '</code></pre>
</section>
<section id="rewriting-commit-messages-adding-text" class="level3">
<h3 class="anchored" data-anchor-id="rewriting-commit-messages-adding-text">Rewriting commit messages – adding text</h3>
<p>Adding Acked-by lines to the last ten commits via</p>
<pre class="shell"><code>  git filter-branch --msg-filter '
          cat &amp;&amp;
          echo "Acked-by: Bugs Bunny &lt;bunny@bugzilla.org&gt;"
      ' master~10..master</code></pre>
<p>becomes</p>
<pre class="shell"><code>  git filter-repo --message-callback '
          return message + b"Acked-by: Bugs Bunny &lt;bunny@bugzilla.org&gt;\n"
      ' --refs master~10..master</code></pre>
</section>
<section id="changing-authorcommittertagger-information" class="level3">
<h3 class="anchored" data-anchor-id="changing-authorcommittertagger-information">Changing author/committer(/tagger?) information</h3>
<pre class="shell"><code>  git filter-branch --env-filter '
      if test "$GIT_AUTHOR_EMAIL" = "root@localhost"
      then
              GIT_AUTHOR_EMAIL=john@example.com
      fi
      if test "$GIT_COMMITTER_EMAIL" = "root@localhost"
      then
              GIT_COMMITTER_EMAIL=john@example.com
      fi
      ' -- --all</code></pre>
<p>becomes either</p>
<pre class="shell"><code>  # Ensure '&lt;john@example.com&gt; &lt;root@localhost&gt;' is a line in .mailmap, then:
  git filter-repo --use-mailmap</code></pre>
<p>or</p>
<pre class="shell"><code>  git filter-repo --email-callback '
    return email if email != b"root@localhost" else b"john@example.com"
    '</code></pre>
<p>(and as a bonus both filter-repo alternatives will fix tagger emails too, unlike the filter-branch example)</p>
</section>
<section id="restricting-to-a-range" class="level3">
<h3 class="anchored" data-anchor-id="restricting-to-a-range">Restricting to a range</h3>
<p>The partial examples</p>
<pre class="shell"><code>  git filter-branch ... C..H</code></pre>
<pre class="shell"><code>  git filter-branch ... C..H ^D</code></pre>
<pre class="shell"><code>  git filter-branch ... D..H ^C</code></pre>
<p>become</p>
<pre class="shell"><code>  git filter-repo ... --refs C..H</code></pre>
<pre class="shell"><code>  git filter-repo ... --refs C..H ^D</code></pre>
<pre class="shell"><code>  git filter-repo ... --refs D..H ^C</code></pre>
<p>Note that filter-branch accepts <code>--not</code> among the revision specifiers, but that appears to python to be a flag name which breaks parsing. So, instead of e.g.&nbsp;<code>--not C</code> as we might use with filter-branch, we can specify <code>^C</code> to filter-repo.</p>
</section>
</section>
<section id="cheat-sheet-additional-conversion-examples" class="level2">
<h2 class="anchored" data-anchor-id="cheat-sheet-additional-conversion-examples">Cheat Sheet: Additional conversion examples</h2>
<section id="running-a-code-formatter-or-linter-on-each-file-with-some-extension" class="level3">
<h3 class="anchored" data-anchor-id="running-a-code-formatter-or-linter-on-each-file-with-some-extension">Running a code formatter or linter on each file with some extension</h3>
<p>Running some program on a subset of files is relatively natural in filter-branch:</p>
<pre class="shell"><code>  git filter-branch --tree-filter '
      git ls-files -z "*.c" \
          | xargs -0 -n 1 clang-format -style=file -i
      '</code></pre>
<p>filter-repo decided not to provide a way to run an external program to do filtering, because most filter-branch uses of this ability are riddled with <a href="https://git-scm.com/docs/git-filter-branch#SAFETY">safety problems</a> and <a href="https://git-scm.com/docs/git-filter-branch#PERFORMANCE">performance issues</a>. However, in special cases like this it’s fairly safe. One can write a script that uses filter-repo as a library to achieve this, while also gaining filter-repo’s automatic handling of other concerns like rewriting commit IDs in commit messages or pruning commits that become empty. In fact, one of the <a href="../contrib/filter-repo-demos">contrib demos</a>, <a href="../contrib/filter-repo-demos/lint-history">lint-history</a>, handles this exact type of situation already:</p>
<pre class="shell"><code>  lint-history --relevant 'return filename.endswith(b".c")' \
      clang-format -style=file -i</code></pre>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>